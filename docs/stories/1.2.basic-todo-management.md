# Story 1.2: Basic TODO Management

## Story Overview

**Story ID**: 1.2
**Epic**: Foundation & Plant Companion Core
**Estimated Effort**: 1.5 hours
**Priority**: Critical (Core functionality)

## User Story

As a **user**,
I want **to create, view, and mark TODOs as complete with immediate database persistence**,
So that **I can efficiently manage my daily tasks with reliable data storage**.

## Acceptance Criteria

### Backend API Implementation
1. ✅ TodoController with all CRUD endpoints implemented
2. ✅ TodoService with business logic for TODO operations
3. ✅ TodoRepository with JPA query methods
4. ✅ DTO classes for request/response handling
5. ✅ Input validation on all endpoints

### API Endpoints (RESTful)
6. ✅ `POST /api/todos` - Create new TODO
7. ✅ `GET /api/todos` - List all TODOs for default plant
8. ✅ `PUT /api/todos/{id}` - Update existing TODO
9. ✅ `DELETE /api/todos/{id}` - Delete TODO
10. ✅ `PATCH /api/todos/{id}/complete` - Toggle completion status

### Frontend Implementation
11. ✅ Todo list component displaying all TODOs
12. ✅ Add new TODO form with text input
13. ✅ TODO items with completion checkbox
14. ✅ Visual distinction for completed TODOs
15. ✅ Delete functionality for TODO items

### Data Persistence
16. ✅ All TODO operations persist to MySQL database
17. ✅ Completed status and timestamp properly saved
18. ✅ TODO-Plant relationship maintained (plantId foreign key)
19. ✅ Data integrity constraints enforced
20. ✅ Proper transaction handling for database operations

## Technical Implementation Details

### Implementation Sequence (Must Follow Order)
1. **DTO Classes** → Request/Response objects
2. **Repository Interface** → Data access methods
3. **Service Layer** → Business logic implementation
4. **Controller Layer** → REST API endpoints
5. **Frontend Components** → UI implementation
6. **Integration Testing** → End-to-end verification

### Required DTO Classes

**TodoCreateRequest.java**:
```java
@Valid
public class TodoCreateRequest {
    @NotBlank(message = "Title is required")
    @Size(max = 255, message = "Title must be less than 255 characters")
    private String title;

    @Size(max = 1000, message = "Description must be less than 1000 characters")
    private String description;

    private Long plantId = 1L; // Default plant
}
```

**TodoResponse.java**:
```java
public class TodoResponse {
    private Long id;
    private String title;
    private String description;
    private Boolean completed;
    private LocalDateTime completedAt;
    private LocalDateTime createdAt;
    private Long plantId;
}
```

### Repository Methods

**TodoRepository.java**:
```java
public interface TodoRepository extends JpaRepository<Todo, Long> {
    List<Todo> findByPlantIdOrderByCreatedAtDesc(Long plantId);
    List<Todo> findByPlantIdAndCompletedOrderByCreatedAtDesc(Long plantId, Boolean completed);
    Long countByPlantIdAndCompleted(Long plantId, Boolean completed);
}
```

### Service Layer Methods

**TodoService.java** must include:
- `createTodo(TodoCreateRequest)` → TodoResponse
- `getTodosByPlant(Long plantId)` → List<TodoResponse>
- `updateTodo(Long id, TodoUpdateRequest)` → TodoResponse
- `deleteTodo(Long id)` → void
- `completeTodo(Long id)` → TodoResponse (triggers plant growth)

### Frontend Component Structure

**Components to Create**:
- `TodoList.tsx` - Main container component
- `TodoItem.tsx` - Individual TODO item with checkbox
- `TodoForm.tsx` - Add new TODO form
- `TodoService.ts` - API service calls

### Required React Hooks
```typescript
const useTodos = () => {
    const [todos, setTodos] = useState<Todo[]>([]);
    const [loading, setLoading] = useState<boolean>(false);
    const [error, setError] = useState<string | null>(null);

    // CRUD operations
    const fetchTodos = async () => { /* implementation */ };
    const createTodo = async (todo: TodoCreate) => { /* implementation */ };
    const updateTodo = async (id: number, todo: TodoUpdate) => { /* implementation */ };
    const deleteTodo = async (id: number) => { /* implementation */ };
    const completeTodo = async (id: number) => { /* implementation */ };
}
```

## Definition of Done Checklist

### Backend Verification
- [ ] All 5 API endpoints return correct HTTP status codes
- [ ] Request validation works (400 for invalid input)
- [ ] Database queries execute without errors
- [ ] Proper error responses for not found (404)
- [ ] JSON serialization/deserialization working

### Frontend Verification
- [ ] Can create new TODOs through UI
- [ ] TODO list displays all items from database
- [ ] Checkbox toggles completion status immediately
- [ ] Completed TODOs show visual distinction (strikethrough/different color)
- [ ] Can delete TODOs with confirmation

### Database Verification
- [ ] TODOs persist across application restarts
- [ ] Completed timestamp set only when completed=true
- [ ] Plant foreign key relationship maintained
- [ ] No orphaned records when deleting
- [ ] Database constraints prevent invalid data

### Integration Verification
- [ ] Frontend updates immediately after backend operations
- [ ] Error messages from backend displayed in UI
- [ ] Loading states shown during API calls
- [ ] No console errors in browser or server logs
- [ ] CRUD operations work seamlessly end-to-end

## Success Criteria

Story is complete when:
1. **Full CRUD functionality working** in both UI and API
2. **Data persists reliably** across browser refresh/server restart
3. **User experience is smooth** with immediate feedback
4. **Error handling covers edge cases** gracefully
5. **Ready for plant integration** (Story 1.3 dependency met)

## Blocking Dependencies

**Blocked By**: Story 1.1 (Foundation & Database Setup)
**Blocks**: Story 1.3 (Plant Companion System)

## Critical Notes for Implementer

- **Plant Integration Prep**: Every TODO must have `plantId=1` for default plant
- **Completion Hook**: `completeTodo` method will be extended in Story 1.3 for plant growth
- **Transaction Management**: Use `@Transactional` for multi-step operations
- **Error Handling**: Frontend must handle network errors gracefully
- **Validation**: Both client-side and server-side validation required
- **Performance**: Use proper HTTP methods and status codes
- **Testing**: Test with various input lengths and special characters

## Test Scenarios

1. **Happy Path**: Create → View → Complete → Delete TODO
2. **Validation**: Try creating TODO with empty title (should fail)
3. **Persistence**: Create TODO, restart server, verify still exists
4. **Completion**: Toggle completion status multiple times
5. **Error Handling**: Disconnect database, verify error messages
6. **Edge Cases**: Very long titles, special characters, HTML tags